<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>RobSON & migos</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="js/three.js"></script>
        <script src="js/Detector.js"></script>
        <script src="js/OrbitControl.js"></script>
        <script src="js/OBJLoader.js"></script>
        <script src="js/MTLLoader.js"></script>
        <script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>
				<script src="js/threex.keyboardstate.js"></script>
				<script src='js/Tween.js'></script>
				
		<script>

            if(!Detector.webgl){
                Detector.addGetWebGLMessage();
            }
            var container;
            var scene, camera_1, camera_2, controls, renderer;
						var group = new THREE.Group();
            var ambient;
						var keyboard = new THREEx.KeyboardState();
            init();
            animate();

            function init(){
								container = document.createElement('div');
								document.body.appendChild(container);

                scene = new THREE.Scene();

                camera_1 = new THREE.PerspectiveCamera(10, window.innerWidth / window.innerHeight, 0.1, 1000);
								group.add(camera_1);
								camera_1.position.set(100, 0, 100);
								camera_1.lookAt(scene.position);

								camera_2 = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
								group.add(camera_2);
								camera_2.position.set(-10, 15, 10);
								camera_2.lookAt(scene.position);


								camera_3 = new THREE.PerspectiveCamera(30, window.innerWidth / window.innerHeight, 0.1, 1000);
								group.add(camera_3);


								ambient = new THREE.AmbientLight(0xffffff, 1.0);
								group.add(ambient);

		            keyLight = new THREE.DirectionalLight(new THREE.Color('hsl(30, 100%, 75%)'), 1.0);
		            keyLight.position.set(-100, 0, 100);
		            fillLight = new THREE.DirectionalLight(new THREE.Color('hsl(240, 100%, 75%)'), 0.75);
		            fillLight.position.set(100, 0, 100);
		            backLight = new THREE.DirectionalLight(0xffffff, 1.0);
		            backLight.position.set(100, 0, -100).normalize();

								var mtlLoader = new THREE.MTLLoader();
							  mtlLoader.setTexturePath('imgs/Robot/');
							  mtlLoader.setPath('imgs/Robot/');
							  mtlLoader.load('robot.mtl', function (materials) {
								  materials.preload();

									/*
								  materials.materials.default.map.magFilter = THREE.NearestFilter;
								  materials.materials.default.map.minFilter = THREE.LinearFilter;
									*/
									var objLoader = new THREE.OBJLoader();
								  objLoader.setMaterials(materials);
								  objLoader.setPath('imgs/Robot/');
									objLoader.load('robot.obj',function	(object){
										object.position.x = 10;
										object.position.y = 10;
										object.position.z = 100;
										group.add(object);
								  });
							  });



								// TODO: inserir qualquer outro objeto que não seja nativo do three.js pra testar o posicionamento
								insereCubo(5, 0, 0);
								insereCubo(0, 4, 0);
								insereEsfera(-5, 0, 0);
/* ---------------------------------------------------------------------------------------------- */

								console.log(mtlLoader.position);
								console.log(camera_3.position.x);
								SUBDIVISIONS = 20;
								geometry = new THREE.Geometry();
								curve = new THREE.QuadraticBezierCurve3();
								curve.v0 = new THREE.Vector3(0, 0, 0);
								curve.v1 = new THREE.Vector3(4, 10, 0);
								curve.v2 = new THREE.Vector3(10, -3, 0);
								for (j = 0; j < SUBDIVISIONS; j++) {
								   geometry.vertices.push( curve.getPoint(j / SUBDIVISIONS) )
								}

								material = new THREE.LineBasicMaterial( { color: 0xffffff, linewidth: 2 } );
								line = new THREE.Line(geometry, material);
								group.add(line);

								var target = {x: 100, y: 200, z: -100};
								// tentando mexer na camera 3 pra fazer ela ficar bonitinha seguindo o RobSON
								var selectedObject = camera_3.position;

								//console.log("camera_3 x:", selectedObject.position.x);
								//console.log("camera_3 y:", selectedObject.position.y);
								//console.log("camera_3 z:", selectedObject.position.z);

								console.log("camera_3 z:", selectedObject.z);

								var tween = new createjs.Tween.selectedObject.to({
								    x: selectedObject.position.x,
								    y: selectedObject.position.y,
								    z: selectedObject.position.z 
								}).easing(TWEEN.Easing.Linear.None).onUpdate(function () {
								    camera_3.lookAt(camera_3.target);
								}).onComplete(function () {
								    camera_3.lookAt(selectedObject.position);
								}).start();

								var tween = new createjs.Tween.target.to({
								    x: selectedObject.target.x,
								    y: selectedObject.target.y,
								    z: 0
								}).easing(TWEEN.Easing.Linear.None).onUpdate(function () {
								}).onComplete(function () {
								    camera_3.lookAt(selectedObject.position);
								}).start();



/* ---------------------------------------------------------------------------------------------- */


								scene.add(group);
								renderer = new THREE.WebGLRenderer();
								renderer.setPixelRatio(window.devicePixelRatio);
								renderer.setSize(window.innerWidth, window.innerHeight);
								renderer.setClearColor(new THREE.Color("hsl(0, 0%, 10%)"));

								container.appendChild(renderer.domElement);

								control_1 = new THREE.OrbitControls(camera_1, renderer.domElement);
								control_1.enableDamping = true;
								control_1.dampingFactor = 0.25;
								control_1.enableZoom = false;

								control_2 = new THREE.OrbitControls(camera_2, renderer.domElement);
								control_2.enableDamping = true;
								control_2.dampingFactor = 0.25;
								control_2.enableZoom = false;

								renderer.render(scene, camera_1);

            }
      function animate(){
          requestAnimationFrame(animate);
					render();
          // TWEEN.update();
      }

			function move(object){
				object.translateX(3);
			}

			function insereCubo(x,y,z){
				var geom_cubo = new THREE.BoxBufferGeometry(1, 1, 1);
				var mat_cubo = new THREE.MeshNormalMaterial();
				var cubo = new THREE.Mesh(geom_cubo, mat_cubo);
				cubo.position.set(x, y, z);
				group.add(cubo);
			}
			// TODO: esssa esfera nem é uma esfera. tentar consertar
			function insereEsfera(x,y,z){
				var geom_esf = new THREE.SphereGeometry(1, 1, 1);
				var mat_esf = new THREE.MeshNormalMaterial();
				var esf = new THREE.Mesh(geom_esf, mat_esf);
				esf.position.set(x, y, z);
				group.add(esf);
			}

			function render(){
				control_1.update();
				control_2.update();
				if(keyboard.pressed("1")){
					renderer.render(scene, camera_1);
					control_1.update();
				}
				if(keyboard.pressed("2")) {
					renderer.render(scene, camera_2);
					control_2.update();
				}
			}

		</script>
	</body>
</html>
